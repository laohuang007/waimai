import{d as T,s as j,i as G,c as J,j as U,o as n,a as V,m as t,w as d,e as o,b as u,F as k,r as C,C as p,G as R,E as L,J as z}from"./index-CSq49O89.js";import{E as H,a as K}from"./el-form-item-D2KaSZi6.js";import"./el-tag-DCrYKok3.js";import{E as M,a as Q}from"./el-select-myCgb1GQ.js";import"./el-tree-CPgl9nFa.js";import"./el-checkbox-Duk-MLvO.js";import{E as W}from"./el-tree-select-DPxVB4lO.js";import{_ as X}from"./picker-B5B6R_zK.js";import{d as Y}from"./department-CL1YnJx0.js";import{e as Z}from"./post-B20_fT6k.js";import{a as $,b as h,c as ee}from"./admin-CKnxMmuh.js";import{r as le}from"./role-DHLAGC4l.js";import{P as oe}from"./index-BSLFXMtF.js";import{u as ae}from"./useDictOptions-B46o9f4U.js";const te={class:"edit-popup"},Ee=T({__name:"edit",emits:["success","close"],setup(re,{expose:q,emit:D}){const v=D,w=j(),m=j(),f=G("add"),F=J(()=>f.value=="edit"?"编辑管理员":"新增管理员"),l=U({id:"",account:"",name:"",dept_id:[],jobs_id:[],role_id:[],avatar:"",password:"",password_confirm:"",disable:0,multipoint_login:1,root:0}),g=(i,e,r)=>{l.password&&(e||r(new Error("请再次输入密码")),e!==l.password&&r(new Error("两次输入密码不一致!"))),r()},_=U({account:[{required:!0,message:"请输入账号",trigger:["blur"]}],name:[{required:!0,message:"请输入名称",trigger:["blur"]}],role_id:[{required:!0,validator:(i,e,r)=>{l.root||l.role_id.length?r():r(new Error("请选择角色"))}}],password:[{required:!0,message:"请输入密码",trigger:["blur"]}],password_confirm:[{required:!0,message:"请输入确认密码",trigger:["blur"]},{validator:g,trigger:"blur"}]}),{optionsData:c}=ae({role:{api:le},jobs:{api:Z},dept:{api:Y}}),A=async()=>{var i,e;await((i=w.value)==null?void 0:i.validate()),f.value=="edit"?await $(l):await h(l),(e=m.value)==null||e.close(),v("success")},B=(i="add")=>{var e;f.value=i,(e=m.value)==null||e.open()},I=async i=>{_.password=[],_.password_confirm=[{validator:g,trigger:"blur"}];const e=await ee({id:i.id});for(const r in l)e[r]!=null&&e[r]!=null&&(l[r]=e[r])},S=()=>{v("close")};return q({open:B,setFormData:I}),(i,e)=>{const r=L,s=H,N=X,O=W,E=M,y=Q,x=z,P=K;return n(),V("div",te,[t(oe,{ref_key:"popupRef",ref:m,title:o(F),async:!0,width:"550px",onConfirm:A,onClose:S},{default:d(()=>[t(P,{ref_key:"formRef",ref:w,model:o(l),"label-width":"84px",rules:o(_)},{default:d(()=>[t(s,{label:"账号",prop:"account"},{default:d(()=>[t(r,{modelValue:o(l).account,"onUpdate:modelValue":e[0]||(e[0]=a=>o(l).account=a),disabled:o(l).root==1,placeholder:"请输入账号",clearable:""},null,8,["modelValue","disabled"])]),_:1}),t(s,{label:"头像"},{default:d(()=>[u("div",null,[u("div",null,[t(N,{modelValue:o(l).avatar,"onUpdate:modelValue":e[1]||(e[1]=a=>o(l).avatar=a),limit:1},null,8,["modelValue"])]),e[10]||(e[10]=u("div",{class:"form-tips"},"建议尺寸：100*100px，支持jpg，jpeg，png格式",-1))])]),_:1}),t(s,{label:"名称",prop:"name"},{default:d(()=>[t(r,{modelValue:o(l).name,"onUpdate:modelValue":e[2]||(e[2]=a=>o(l).name=a),placeholder:"请输入名称",clearable:""},null,8,["modelValue"])]),_:1}),t(s,{label:"归属部门",prop:"dept_id"},{default:d(()=>[t(O,{class:"flex-1",modelValue:o(l).dept_id,"onUpdate:modelValue":e[3]||(e[3]=a=>o(l).dept_id=a),data:o(c).dept,clearable:"",multiple:"","node-key":"id",props:{value:"id",label:"name",disabled(a){return a.status!==1}},"check-strictly":"","default-expand-all":!0,placeholder:"请选择上级部门"},null,8,["modelValue","data","props"])]),_:1}),t(s,{label:"岗位",prop:"jobs_id"},{default:d(()=>[t(y,{class:"flex-1",modelValue:o(l).jobs_id,"onUpdate:modelValue":e[4]||(e[4]=a=>o(l).jobs_id=a),clearable:"",multiple:"",placeholder:"请选择岗位"},{default:d(()=>[(n(!0),V(k,null,C(o(c).jobs,(a,b)=>(n(),p(E,{key:b,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(l).root!=1?(n(),p(s,{key:0,label:"角色",prop:"role_id"},{default:d(()=>[t(y,{modelValue:o(l).role_id,"onUpdate:modelValue":e[5]||(e[5]=a=>o(l).role_id=a),disabled:o(l).root==1,class:"flex-1",multiple:"",placeholder:"请选择角色",clearable:""},{default:d(()=>[(n(!0),V(k,null,C(o(c).role,(a,b)=>(n(),p(E,{key:b,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})):R("",!0),t(s,{label:"密码",prop:"password"},{default:d(()=>[t(r,{modelValue:o(l).password,"onUpdate:modelValue":e[6]||(e[6]=a=>o(l).password=a),"show-password":"",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(s,{label:"确认密码",prop:"password_confirm"},{default:d(()=>[t(r,{modelValue:o(l).password_confirm,"onUpdate:modelValue":e[7]||(e[7]=a=>o(l).password_confirm=a),"show-password":"",clearable:"",placeholder:"请输入确认密码"},null,8,["modelValue"])]),_:1}),o(l).root!=1?(n(),p(s,{key:1,label:"管理员状态"},{default:d(()=>[t(x,{modelValue:o(l).disable,"onUpdate:modelValue":e[8]||(e[8]=a=>o(l).disable=a),"active-value":0,"inactive-value":1},null,8,["modelValue"])]),_:1})):R("",!0),t(s,{label:"多处登录"},{default:d(()=>[u("div",null,[t(x,{modelValue:o(l).multipoint_login,"onUpdate:modelValue":e[9]||(e[9]=a=>o(l).multipoint_login=a),"active-value":1,"inactive-value":0},null,8,["modelValue"]),e[11]||(e[11]=u("div",{class:"form-tips"},"允许多人同时在线登录",-1))])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])])}}});export{Ee as _};
